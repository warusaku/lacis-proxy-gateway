# LPG本番環境構築ログ - 2025年7月31日

## 概要
Orange Pi Zero 3へのLacis Proxy Gateway (LPG)本番環境構築作業ログ

## 環境情報
- **デバイス**: Orange Pi Zero 3
- **IPアドレス**: 192.168.234.2
- **VLAN**: 555 (lacis_proxy_gateway)
- **管理者**: lacissystem / lacis12345@

## 実施内容

### 1. デプロイメントパッケージの作成
```bash
# 必要なファイルをパッケージング
tar -czf lpg-deploy.tar.gz config/ scripts/
```

作成されたファイル:
- lpg-deploy.tar.gz (21906 bytes)

### 2. 含まれるファイル

#### 設定ファイル (config/)
- config.json - LPG本番設定
- caddy/Caddyfile - Caddyリバースプロキシ設定
- vsftpd/vsftpd.conf - FTPサーバー設定
- telegraf/telegraf.conf - メトリクス収集設定

#### スクリプト (scripts/)
- setup-lpg.sh - 本番環境セットアップスクリプト
- docker-entrypoint.sh - コンテナエントリーポイント
- ftp-deploy-watcher.sh - FTPデプロイ監視
- setup-ftp.sh - FTPサーバーセットアップ
- lpg-health-check.sh - ヘルスチェック
- backup-lpg.sh - バックアップスクリプト
- security-hardening.sh - セキュリティ強化
- generate-certs.sh - 証明書生成

### 3. デプロイ手順

#### Step 1: ファイル転送
```bash
scp lpg-deploy.tar.gz lacissystem@192.168.234.2:/home/lacissystem/
```

#### Step 2: SSH接続
```bash
ssh lacissystem@192.168.234.2
```

#### Step 3: セットアップ実行
```bash
tar -xzf lpg-deploy.tar.gz
sudo ./scripts/setup-lpg.sh
```

### 4. セットアップスクリプトの動作

1. **システムアップデート**
   - apt update && apt upgrade

2. **必要パッケージのインストール**
   - Caddy (リバースプロキシ)
   - vsftpd (FTPサーバー)
   - Go言語環境
   - その他ユーティリティ

3. **ディレクトリ構成**
   ```
   /opt/lpg/          - アプリケーションルート
   /etc/lpg/          - 設定ファイル
   /var/log/lpg/      - ログファイル
   /var/ftp/lpg/      - FTPディレクトリ
   ```

4. **ファイアウォール設定**
   - SSH: 22 (VLAN1からのみ)
   - HTTP: 80 (VLAN1からのみ)
   - HTTPS: 443 (VLAN1からのみ)
   - Admin UI: 8443 (VLAN1からのみ)
   - FTP: 21, 30000-30100 (VLAN1からのみ)

5. **サービス設定**
   - Caddy: 自動起動設定
   - vsftpd: 自動起動設定
   - lpg: systemdサービス作成

### 5. 設定内容

#### config.json
- ドメイン: lacisstack.ath.cx
- ネットワーク: 192.168.234.0/24
- ルーティング設定:
  - /board → 192.168.234.10:8080
  - /board/ws → 192.168.234.10:8081
  - /api → 192.168.234.11:3000

#### セキュリティ設定
- 管理者: lacisadmin
- パスワード: Argon2idハッシュ化済み
- アクセス制限: VLAN1 (192.168.3.0/24)からのみ

### 6. 次のステップ

1. **Go APIバイナリのビルド**
   - ローカルまたはCIでビルド
   - FTP経由でデプロイ

2. **動作確認**
   - ヘルスチェックエンドポイント
   - 管理UI接続テスト
   - リバースプロキシ動作確認

3. **LacisDrawBoards接続準備**
   - テスト環境の構築
   - ルーティング設定の確認

## 注意事項

- デフォルトパスワードは初回ログイン後に変更すること
- FTP接続は暗号化（FTPS）を使用すること
- 定期的なバックアップを設定すること

## トラブルシューティング

### SSH接続できない場合
1. VLAN設定の確認
2. ファイアウォールルールの確認
3. IPアドレスの確認

### サービスが起動しない場合
1. ログファイルの確認: /var/log/lpg/
2. 設定ファイルの文法チェック
3. ポートの競合確認

---
作成日: 2025年7月31日
作成者: Claude Code Assistant