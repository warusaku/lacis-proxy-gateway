# LPG v2.31 - 設定ファイル統一

## 変更日時
2025年8月12日 15:54 UTC

## 問題の概要
LPGシステムが2つの異なる設定ファイルを使用していたため、管理UIでの変更がプロキシサービスに反映されない問題が発生していました。

### 問題の詳細
- **lpg_admin.py（管理UI）**: `/etc/lpg/config.json`を編集
- **lpg-proxy.py（プロキシ）**: `/opt/lpg/src/config.json`を参照
- 結果として、管理UIでポートを3000に変更してもプロキシは古い設定（ポート80）を使用し続けていた

## 実施した修正

### 1. バックアップの作成
```bash
cp /opt/lpg/src/config.json /opt/lpg/src/config.json.bak_20250813_005443
cp /etc/lpg/config.json /etc/lpg/config.json.bak_20250813_005443
```

### 2. シンボリックリンクの作成
```bash
rm /opt/lpg/src/config.json
ln -s /etc/lpg/config.json /opt/lpg/src/config.json
```

### 3. サービスの再起動
```bash
systemctl restart lpg-proxy
systemctl restart lpg-admin
```

## 修正後の動作確認

### プロキシログ
```
2025-08-12 15:55:59 - Proxying HEAD /lacisstack/boards/ -> http://192.168.234.10:3000/
2025-08-12 15:55:59 - "HEAD /lacisstack/boards/ HTTP/1.1" 200 -
```

プロキシが正しくポート3000を使用するようになりました。

## 影響範囲
- LPGプロキシサービス
- LPG管理UI
- LacisDrawBoardsへのアクセス

## バックアップ
- 場所: `/Volumes/crucial_MX500/lacis_project/project/LPG/backup/v2.31/lpg_v2.31_config_backup.tar.gz`
- 内容:
  - `/etc/lpg/config.json`
  - `/opt/lpg/src/*.py`
  - `/etc/nginx/sites-enabled/lpg-proxy`
  - `/etc/systemd/system/lpg-*.service`

## ロールバック手順
問題が発生した場合は以下の手順でロールバックできます：

```bash
# シンボリックリンクを削除
rm /opt/lpg/src/config.json

# 元の設定ファイルを復元
cp /opt/lpg/src/config.json.bak_20250813_005443 /opt/lpg/src/config.json

# サービスを再起動
systemctl restart lpg-proxy
systemctl restart lpg-admin
```

## 今後の推奨事項
1. 設定ファイルは常に`/etc/lpg/config.json`を使用する
2. すべてのLPGコンポーネントが同じ設定ファイルを参照するようにする
3. 設定変更後は必ずサービスの再起動を行う