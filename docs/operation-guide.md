# LPG 操作ガイド

## 目次
1. [ログイン](#ログイン)
2. [ダッシュボード](#ダッシュボード)
3. [トポロジービュー](#トポロジービュー)
4. [デバイス管理](#デバイス管理)
5. [ドメイン管理](#ドメイン管理)
6. [ネットワーク監視](#ネットワーク監視)
7. [ログ管理](#ログ管理)
8. [設定管理](#設定管理)
9. [トラブルシューティング](#トラブルシューティング)

## ログイン

### アクセス方法

1. ブラウザで以下のURLにアクセス:
   ```
   https://your-domain.com/lpg-admin/
   ```

2. ログイン画面が表示されます

### ログイン手順

1. **ユーザー名**フィールドに `admin` を入力
2. **パスワード**フィールドにパスワードを入力（デフォルト: `lpgadmin123`）
3. **Login**ボタンをクリック

### セッション管理

- セッションタイムアウト: 30分（無操作時）
- 同時ログイン: 制限なし
- ログアウト: 右上の**Logout**ボタンをクリック

## ダッシュボード

### 概要

ログイン後、トポロジービューがダッシュボードとして表示されます。

### メトリクス表示

#### 接続デバイス数
- 現在アクティブなデバイス数を表示
- リアルタイムで更新

#### アクティブセッション
- 現在のプロキシセッション数
- WebSocketを含む全接続数

#### システム稼働時間
- LPGサービスの稼働時間
- 日/時間/分形式で表示

#### 帯域使用率
- ネットワーク帯域の使用率
- パーセンテージ表示

## トポロジービュー

### 概要

ネットワークトポロジーを視覚的に表示します。D3.jsを使用したインタラクティブな表示。

### 表示要素

#### ノード（デバイス）
- **青色ノード**: LPGゲートウェイ（中央）
- **緑色ノード**: アクティブなデバイス
- **灰色ノード**: 非アクティブなデバイス
- **赤色ノード**: エラー状態のデバイス

#### 接続線
- デバイスとLPGゲートウェイ間の接続を表示
- アニメーション効果でトラフィックフローを表現

#### バッジ
- 各デバイスのアクセス数を表示
- リアルタイムで更新

### インタラクション

- **ズーム**: マウスホイールでズームイン/アウト
- **パン**: ドラッグで表示位置を移動
- **詳細表示**: デバイスをクリックで詳細情報表示

### Device Details テーブル

トポロジービューの下部に表示される詳細テーブル:

| カラム | 説明 |
|--------|------|
| Device | デバイス名とアイコン |
| Description | デバイスの説明 |
| IP Address | IPアドレス |
| Port | ポート番号 |
| Path | プロキシパス |
| Full URL | 完全なURL |
| Status | 動作状態 |

## デバイス管理

### デバイス一覧

左メニューの**Devices**をクリックして表示。

### デバイスの追加

1. **Add Device**ボタンをクリック
2. モーダルウィンドウが表示
3. 必要な情報を入力:
   - **Device Name**: デバイス名（必須）
   - **Description**: 説明
   - **IP Address**: IPアドレス（必須）
   - **Port**: ポート番号（必須）
   - **Path**: プロキシパス（例: `/api/`）
   - **Domain**: ドメイン選択（ドロップダウン）
   - **Device Type**: デバイスタイプ選択
4. **Add Device**ボタンをクリック

### デバイスの編集

1. デバイスカードの**Edit**ボタンをクリック
2. モーダルウィンドウで情報を編集
3. **Update Device**ボタンをクリック

### デバイスの削除

1. デバイスカードの**Delete**ボタンをクリック
2. 確認ダイアログで**OK**をクリック

### デバイスステータスの確認

各デバイスカードに表示される情報:
- **Status Badge**: Active（緑）/ Inactive（赤）
- **IP:Port**: 接続先情報
- **Type**: デバイスタイプアイコン
- **Access Count**: アクセス数

## ドメイン管理

### ドメイン一覧

左メニューの**Domains**をクリックして表示。

### ドメインテーブル

| カラム | 説明 |
|--------|------|
| Domain | ドメイン名 |
| Path | 設定されているパス |
| Upstream | プロキシ先URL |
| Status | 有効/無効 |
| Actions | 編集/削除ボタン |

### ドメインの追加

1. **Add Domain**ボタンをクリック
2. 必要な情報を入力:
   - **Domain Name**: ドメイン名
   - **Path**: パス（例: `/app/`）
   - **Upstream URL**: プロキシ先URL
3. **Save**ボタンをクリック

### パスルーティングの設定

1. ドメイン行の**Edit**ボタンをクリック
2. **Add Path**でパスを追加
3. 各パスに対してプロキシ先を設定
4. **Save Changes**をクリック

## ネットワーク監視

### ネットワーク状態

左メニューの**Network**をクリックして表示。

### 表示される情報

#### インターフェース情報
- インターフェース名
- IPアドレス
- MACアドレス
- 送受信バイト数
- パケット数
- エラー/ドロップ数

#### トラフィック統計
- 受信トラフィック（Mbps）
- 送信トラフィック（Mbps）
- 総パケット数
- エラー率

#### 接続状態
- アクティブな接続数
- 接続タイプ別統計
- ポート別使用状況

### リアルタイム更新

- 5秒ごとに自動更新
- 手動更新: **Refresh**ボタン

## ログ管理

### ログビュー

左メニューの**Logs**をクリックして表示。

### ログタイプ

#### アクセスログ
- プロキシ経由のすべてのHTTPリクエスト
- タイムスタンプ、IP、メソッド、パス、ステータスコード

#### システムログ
- LPGシステムの動作ログ
- 起動/停止、エラー、警告メッセージ

#### 監査ログ
- 管理操作の記録
- ログイン、設定変更、デバイス追加/削除

### フィルタリング

1. **Filter**セクションを展開
2. フィルタ条件を設定:
   - **Date Range**: 日付範囲
   - **Log Level**: DEBUG/INFO/WARNING/ERROR
   - **Search**: キーワード検索
3. **Apply Filter**をクリック

### ログのエクスポート

1. **Export**ボタンをクリック
2. 形式を選択（CSV/JSON）
3. ダウンロード開始

## 設定管理

### 設定画面

左メニューの**Settings**をクリックして表示。

### システム設定

#### 基本設定
- **System Name**: システム名
- **Admin Email**: 管理者メールアドレス
- **Timezone**: タイムゾーン設定

#### ネットワーク設定
- **Proxy Timeout**: プロキシタイムアウト（秒）
- **Max Connections**: 最大接続数
- **Keep-Alive**: Keep-Alive設定

#### セキュリティ設定
- **Session Timeout**: セッションタイムアウト（分）
- **Max Login Attempts**: 最大ログイン試行回数
- **IP Whitelist**: 許可IPリスト

### ユーザー管理

#### パスワード変更
1. **Change Password**セクションを展開
2. 現在のパスワードを入力
3. 新しいパスワードを入力（2回）
4. **Update Password**をクリック

#### ユーザーの追加
1. **Add User**ボタンをクリック
2. ユーザー情報を入力:
   - Username
   - Password
   - Email
   - Role（Admin/Viewer）
3. **Create User**をクリック

### バックアップ/リストア

#### バックアップの作成
1. **Backup**セクションを展開
2. **Create Backup**をクリック
3. バックアップファイルがダウンロード

#### リストア
1. **Restore**セクションを展開
2. バックアップファイルを選択
3. **Restore**をクリック
4. 確認ダイアログで**OK**

## トラブルシューティング

### よくある問題

#### ログインできない
- パスワードが正しいか確認
- Caps Lockがオフか確認
- ブラウザのCookieを有効化
- キャッシュをクリア

#### デバイスが表示されない
- デバイスのステータスを確認
- IPアドレスとポートが正しいか確認
- ネットワーク接続を確認
- ログでエラーを確認

#### プロキシが機能しない
- config.jsonの設定を確認
- バックエンドサービスが起動しているか確認
- ファイアウォール設定を確認
- ログでエラーを確認

### ログの確認方法

```bash
# 管理UIのログ
sudo tail -f /var/log/lpg_admin.log

# プロキシのログ
sudo tail -f /var/log/lpg_proxy.log

# システムログ
sudo journalctl -u lpg-admin -f
sudo journalctl -u lpg-proxy -f
```

### サービスの再起動

```bash
# 管理UIの再起動
sudo systemctl restart lpg-admin

# プロキシの再起動
sudo systemctl restart lpg-proxy

# 両方を再起動
sudo systemctl restart lpg-admin lpg-proxy
```

### 緊急時の操作

#### 全サービスの停止
```bash
sudo systemctl stop lpg-admin lpg-proxy
```

#### プロセスの強制終了
```bash
sudo pkill -f lpg_admin
sudo pkill -f lpg-proxy
```

#### 設定のリセット
```bash
# バックアップから復元
sudo cp /opt/lpg/src/config.json.backup /opt/lpg/src/config.json
sudo cp /opt/lpg/src/devices.json.backup /opt/lpg/src/devices.json

# サービス再起動
sudo systemctl restart lpg-admin lpg-proxy
```

## キーボードショートカット

| ショートカット | 機能 |
|---------------|------|
| `Ctrl + K` | 検索 |
| `Ctrl + R` | 更新 |
| `Ctrl + L` | ログアウト |
| `F1` | ヘルプ |
| `F5` | ページ更新 |
| `Esc` | モーダルを閉じる |

## 次のステップ

操作に慣れたら、以下のガイドも参照してください:
- [APIエンドポイント](api-endpoints.md)
- [セキュリティガイド](security-guide.md)
- [トラブルシューティング](troubleshooting.md)